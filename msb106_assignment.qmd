---
title: "msb106_assignment"
format: html
editor: visual
---

# Landskap i utvikling: En analyse av urbane og rurale omr친der i Europa

**MSB106 Anvendt by- og regional칮konomi**

**Hanna Sundal Bjerkreim, Ingrid Str칮mme og Emilie Hansen S칮rhaug**

```{r}
#| label: setup 
#| echo: false
#| output: false
#| message: false
library(tidyverse)
library(readxl)
library(dplyr)
library(ggplot2)
library(flextable)
```

Form친let med denne oppgaven er 친 unders칮ke og presentere potensielle faktorer som bidrar til skillet mellom urbane og rurale omr친der i Europa.
Vi skal unders칮ke hvordan arbeidsledighet, arbeidsvekst og boligpris p친virker m칮nstre for befolkningsfordeling p친 tvers av ulike europeiske landskap.

## Del 1: Datainnsamling og innledende analyse

Den f칮rste delen av oppgaven gir en gjennomgang av prosessen for innhenting av data, etterfulgt av en analyse av befolkningsveksten i ulike europeiske regioner.

### Oppgave 1 -- Datainnsamling

Vi hentet datasettet "*Distribution of population by degree of urbanisation, dwelling type and income group - EU-SILC survey*" fra Eurostat.
Dette datasettet gir befolkning i prosent etter urbaniseringsgradene "cities" (byer), "towns and suburbs" (tettsteder og forsteder), og "rural areas" (rurale omr친der).
Vi valgte 친 laste ned data for 칒sterrike (AT), Belgia (BE), Bulgaria (BG), Kypros (CY), Tjekkia (CZ), Tyskland (DE), Danmark (DK), Estland (EE), Hellas (EL), Spania (ES), Finland (FI), Frankrike (FR), Ungarn (HU), Irland (IE), Italia (IT), Lithauen (LT), Luxemburg (LU), Malta (MT), Nederland (NL), Norge (NO), Polen (PL), Portugal (PT), Sverige (SE), Slovenia (SI) og Slovakia (SK).
Dataene er hentet fra perioden 2003 til 2022.

```{r}
#| echo: false
#| message: false
data <- read_csv("ilc_lvho01__custom_9371289_linear.csv") 
```

```{r}
#| echo: false
data <- data |>
  select(geo, deg_urb, TIME_PERIOD, OBS_VALUE) |>
  filter(!(geo %in% c("LV", "MK", "HR", "RO", "RS", "CH", "AL", "IS"))) |>
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural areas"
  ))
```

### Oppgave 2 - Data analyse

Vi skal n친 analysere befolkningsveksten i ulike europeiske regioner i perioden 2003 til 2022.
Vi bruker Eurostat sin regioninndeling, som omfatter "cities" (byer), "towns and suburbs" (tettsteder og forsteder), og "rural areas" (rurale omr친der).
M친let er 친 unders칮ke utviklingen i hver av disse regioninndelingene og forst친 m칮nstrene i befolkningsvekst over tid.

@fig-gjsnitt-befolkning viser gjennomsittlig befolkningsvekst for "cities", "towns and suburbs" og "rural areas" i perioden 2003 til 2022.
Fra figuren ser vi at "cities" hadde en god befolkningsvekst de to f칮rste 친rene, f칮r det stabiliserte seg og l친 p친 rundt 42% frem til 2011, hvor befolkningen stupte.
Det var en liten vekst etter dette, f칮r befolkningen igjen sank frem til 2015.
Etter dette var det en stabil befolkningsvekst i "cities"-regioner frem til 2020, hvor befolkningen igjen sank.
"Rural areas" hadde ogs친 en befolkningsvekst de to f칮rste 친rene, f칮r befolkningen sank relativt jevnt frem til 2011.
Dette 친ret var det en befolkningsvekst, men i perioden etter ser vi igjen en fallende trend i befolkningsveksten.
For "towns og suburbs"-regioner ser vi i kontrast til de to andre regioninndelingene en stor nedgang i befolkningen de to f칮rste 친rene.
Dette kan tyde p친 at folk flyttet fra tettsteder og forsteder til spesielt byer, men ogs친 rurale omr친der i denne perioden.
N친r vi ser n칝rmere p친 "towns og suburbs"-regioner, snur trenden i 2005 og befolkningen 칮ker slakt frem til 2011.
Videre setter befolkningsveksten fart og 칮ker godt helt frem til 2022, hvor den er p친 sitt h칮yeste.
I perioden etter 2011 er det tydelig at folk dras mot tettsteder og forsteder og flytter bort fra rurale omr친der, men ogs친 fra byene.

```{r}
#| echo: false
#| message: false
#| label: fig-gjsnitt-befolkning
#| fig-cap: "Gjennomsnittlig befolkningsvekst i perioden 2003-2022 fordelt p친 regioninndelingen cities, towns/suburbs og rural areas."

data %>%
  group_by(deg_urb, TIME_PERIOD) %>%
  summarise(mean_value = mean(OBS_VALUE)) %>%
  ggplot(aes(x = TIME_PERIOD, y = mean_value, color = deg_urb)) +
  geom_line() +
  labs(x = "칀r",
       y = "Gjennomsnittlig Befolkningsvekst",
       color = "Regioner") +
  theme_minimal()

```

**Cities**

@tbl-summary-deg1 gir en oversikt over prosentvis befolkningsveksten i de europeiske "Cities"-regionene i perioden 2003 til 2022.
Tabellen presenterer deskriptiv statistikk som gir innsikt i befolkningsutviklingen i denne perioden.

```{r}
#| echo: false
subset_deg1 <- data |> 
  filter(deg_urb == "Cities")
```

```{r}
#| echo: false
#| label: tbl-summary-deg1
#| tbl-cap: "Deskriptiv statistikk for befolkning i `Cities췂-regioner"
summary_deg1 <- subset_deg1 %>%
  summarise(
    min = min(OBS_VALUE),
    median = median(OBS_VALUE),
    mean = mean(OBS_VALUE),
    max = max(OBS_VALUE),
    variance = var(OBS_VALUE),
    std.dev = sd(OBS_VALUE)
  ) %>%
  flextable() |> 
  width(1, width = 3.5) |> 
  width(2, width = 1.5)

summary_deg1
```

Den laveste registrerte befolkningsveksten i en "Cities"-region er 13%, mens den h칮yeste befolkningsveksten er betydelig st칮rre, med en maksimal verdi p친 90.4%.
Dette indikerer en betydelig variasjon i befolkningsveksten blant regionene.
Medianen ligger p친 39.5%, noe som indikerer at halvparten av regionene opplever en befolkningsvekst under denne verdien, mens den andre halvparten har en h칮yere vekst.
Gjennomsnittlig befolkningsvekst i"Cities"-regionene er 40.16%.
Standardavviket, som er 13.99%, indikerer spredningen av individuelle verdier rundt gjennomsnittet.
Dette antyder at det er stor variasjon i befolkningsveksten, og at noen "cities"-regioner skiller seg betydelig ut fra gjennomsnittet.
Variansen er beregnet til 195.97, noe som indikerer en stor spreding i befolkningsvekst blant "cities"-regionene.

**Towns and Suburbs**

Deskriptiv statistikk for den prosentvise befolkningsveksten i "towns and suburbs" er presentert i @tbl-summary-deg2.

```{r}
#| echo: false
subset_deg2 <- data |> 
  filter(deg_urb == "Towns/Suburbs")
```

```{r}
#| echo: false
#| label: tbl-summary-deg2
#| tbl-cap: "Deskriptiv statistikk for befolkning i `Towns and Suburbs췂-regioner"
summary_deg2 <- subset_deg2 %>%
  summarise(
    min = min(OBS_VALUE),
    median = median(OBS_VALUE),
    mean = mean(OBS_VALUE),
    max = max(OBS_VALUE),
    variance = var(OBS_VALUE),
    std.dev = sd(OBS_VALUE)
  ) %>%
  flextable() |> 
  width(1, width = 3.5) |> 
  width(2, width = 1.5)

summary_deg2
```

Variasjonen i befolkningsveksten blant "towns and suburbs"-regionene er betydelig, med lavest verdi p친 0% og h칮yeste verdi p친 55.3%.Medianen ligger p친 29.5% og den gjennomsnittlige befolkningsveksten p친 27.32%.
Standardavviket, som er 11.78%, antyder variasjon i befolkningsvekst, og at noen regioner skiller seg betydelig ut fra gjennomsnittet.
Variansen er beregnet til 138.83%.
Denne verdien reflekterer stor variasjonen i befolkningsvekst blant "Towns and Suburbs"-regionene.

**Rural areas**

@tbl-summary-deg3 gir en oversikt over deskriptiv statistikk for befolkningsveksten i "rural areas".

```{r}
#| echo: false
subset_deg3 <- data |> 
  filter(deg_urb == "Rural areas")
```

```{r}
#| echo: false
#| label: tbl-summary-deg3
#| tbl-cap: "Deskriptiv statistikk for befolkning i `Rural areas췂-regioner"
summary_deg3 <- subset_deg3 %>%
  summarise(
    min = min(OBS_VALUE),
    median = median(OBS_VALUE),
    mean = mean(OBS_VALUE),
    max = max(OBS_VALUE),
    variance = var(OBS_VALUE),
    std.dev = sd(OBS_VALUE)
  ) %>%
  flextable() |> 
  width(1, width = 3.5) |> 
  width(2, width = 1.5)

summary_deg3
```

Den laveste registrerte befolkningsveksten i en "Rural areas"-region er 0.1%, mens den h칮yeste er 66.6%.
Dette indikerer en betydelig variasjon i befolkningsveksten blant regionene.
Medianen ligger p친 33% og gjennomsnittet p친 32,51%.
Standardavviket ligger p친 14.71% og variansen p친 216,36%.

\
\
GRAFER FOR LANDENE:

```{r}
#| echo: false
cities_plot <- data |> 
  filter(deg_urb == "Cities") |> 
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE, color = geo)) +
  geom_line() +
  labs(title = "Population Growth Trends in Cities by Country",
       x = "Year",
       y = "Population Growth",
       color = "Country")

print(cities_plot)
```

```{r}
#| echo: false
towns_suburbs_plot <- data |> 
  filter(deg_urb == "Towns/Suburbs") |> 
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE, color = geo)) +
  geom_line() +
  labs(title = "Population Growth Trends in Towns and Suburbs by Country",
       x = "Year",
       y = "Population Growth",
       color = "Country")

print(towns_suburbs_plot)
```

```{r}
#| echo: false
rural_plot <- data |> 
  filter(deg_urb == "Rural areas") |> 
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE, color = geo)) +
  geom_line() +
  labs(title = "Population Growth Trends in Rural areas by Country",
       x = "Year",
       y = "Population Growth",
       color = "Country")

print(rural_plot)
```

## Del 2: Avansert analyse - Virkningen av 칮konomiske faktorer p친 befolkningsvekst

I denne delen av oppgaven skal vi utvide dataene som vi samlet inn i den f칮rste delen ved 친 inkludere flere 칮konomiske faktorer.
V친r analyse vil fokusere p친 hvordan disse faktorene korrelerer med befolkningsvekst i ulike regioner, ved 친 bruke klassifiseringsmetodikken til Andersson, H친kansson og Thorsen (2023).

### Oppgave 1 -- Innsamling av tilleggsdata

Vi brukte tre forskjellige datasett ved innkludering av flere 칮konomiske faktorer i v친rt opprinnelige datasett.
Vi lastet ned data for de tre 칮konomiske faktorene arbeidsvekst, arbeidsledighet og boligpris fra Eurostat.
Dataene er hentet fra perioden 2003 til 2022 og innkluderer de samme landene og urbaniseringsgradene som for befolkningsdataene.
Datasettet for arbeidsvekst heter *"Employment rates by sex, age, educational attainment level, citizenship and degree of urbanisation",* og datasettet for arbeidsledighet har navnet *"Unemployment rates by sex, age and degree of urbanisation (%)"* .
Datasettet som gir informasjon om boligpris heter "*Housing cost overburden rate by degree of urbanisation - EU-SILC survey***".** Alle de tre datasettene oppgir de 칮konomiske faktorene i prosent.

```{r}
#| echo: false
#| message: false
data1 <- arbeidskraft <- read_csv("arbeidskraft.csv") |> 
  select(arbeidsvekst = OBS_VALUE, geo, age, deg_urb, TIME_PERIOD)

data2 <- arbeidsledighet1 <- read_csv("arbeidsledighet1.csv") |> 
  select(arbeidsledig = OBS_VALUE, geo,age, deg_urb, TIME_PERIOD)

data3 <- huspris <- read_csv("huspris.csv") |> 
  select(huspris = OBS_VALUE, geo, deg_urb, TIME_PERIOD)
```

```{r}
#| echo: false
arbeidsvekst <- data1 |>
  filter(age == "Y15-64") |>
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural Areas",
    TRUE ~ as.character(deg_urb)  # Beholder andre verdier uendret
  ))
```

```{r}
#| echo: false
arbeidsledige <- data2 |> 
  filter(age == "Y15-64") |>
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural Areas",
    TRUE ~ as.character(deg_urb)  # Beholder andre verdier uendret
  ))
```

```{r}
#| echo: false
huspris <- data3 |> 
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural Areas",
    TRUE ~ as.character(deg_urb)  # Beholder andre verdier uendret
  ))
```

```{r}
#| echo: false
join <- arbeidsvekst |> 
  left_join(arbeidsledige, join_by(geo, TIME_PERIOD, deg_urb))

join1 <- join |> 
  left_join(huspris, join_by(geo, TIME_PERIOD, deg_urb))

maindata <- join1 |> 
  left_join(data, join_by(geo, TIME_PERIOD, deg_urb))
```

### Oppgave 2 - Anvendelse av klassifiseringsmetodikk

Vi skal videre i analysen benytte oss av klassifiseringsmetodikken beskrevet i kapittel 5 av Andersson, H친kansson og Thorsen (2023).
Klassifiseringen er basert p친 de tre kriteriene arbeidsledighet (U), arbeidsvekst (郊쓘) og huspris (H).
Kombinasjonen av de tre kriteriene gir oss f칮lgende 8 kategorier:

1.  h칮y U, h칮y 郊쓘, h칮y H
2.  h칮y U, h칮y 郊쓘, lav H
3.  h칮y U, lav 郊쓘, h칮y H
4.  h칮y U, lav 郊쓘, lav H
5.  lav U, h칮y 郊쓘, h칮y H
6.  lav U, h칮y 郊쓘, lav H
7.  lav U, lav 郊쓘, h칮y H
8.  lav U, lav 郊쓘, h칮y H

Lave verdier indikerer at kriteriet er lavere enn gjennomsnittet, mens h칮ye verdier indikerer at kriteriet er h칮yere en gjennomsnittet.

```{r}
#| echo: false
maindata <- maindata %>%
  group_by(geo, TIME_PERIOD) %>%
  mutate(arb.ledig.geo.mean = mean(arbeidsledig, na.rm = TRUE), huspris.geo.mean = mean(huspris, na.rm = TRUE), arb.vekst.geo.mena = mean(arbeidsvekst, na.rm = TRUE))

```

```{r}
#| echo: false
maindata <- maindata %>%
  mutate(classification = case_when(
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "1.h칮y arbeisledighet, h칮y arbeidsvekst, h칮y huspris",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "2.h칮y arbeisledighet, h칮y arbeidsvekst, lav huspris",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "3.h칮y arbeisledighet, lav arbeidsvekst, h칮y huspris",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "4.h칮y arbeisledighet, lav arbeidsvekst, lav huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "5.lav arbeisledighet, h칮y arbeidsvekst, h칮y huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "6.lav arbeisledighet, h칮y arbeidsvekst, lav huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "7.lav arbeisledighet, lav arbeidsvekst, h칮y huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "8. lav arbeisledighet, lav arbeidsvekst, lav huspris")
  )  %>%
  filter(!is.na(classification))
```

```{r}
#| echo: false
maindata <- maindata %>%
  mutate(classification_nr = case_when(
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "1",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "2",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "3",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "4",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "5",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "6",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "7",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "8")
  )  %>%
  filter(!is.na(classification)) 
```

### Oppgave 3 - Analyse og visualisering

@fig-stolpediagram viser ....

```{r}
#| echo: false
#| label: fig-stolpediagram
#| fig-cap: "Stolpediagram basert p친 klassifiseringe og regioninndeling."
# Lag stolpediagram
stolpediagram <- ggplot(maindata, aes(x = as.factor(classification_nr), fill = deg_urb)) +
  geom_bar(position = "dodge", stat = "count") +
  labs(title = "Stolpediagram basert p친 Classification_nr og deg_urb",
       x = "classification_nr",
       y = "Antall") +
  theme_minimal()

# Vis stolpediagrammet
print(stolpediagram)
```

```{r}
maindata %>%
  group_by(classification_nr, TIME_PERIOD) %>%
  summarise(mean_value = mean(OBS_VALUE, na.rm = TRUE)) %>%
    mutate(demeaned_value = mean_value/first(mean_value)) %>%
  ggplot(aes(x = TIME_PERIOD, y = demeaned_value, color = classification_nr)) +
  geom_line() +
  labs(x = "칀r",
       y = "Gjennomsnittlig Befolkningsvekst",
       color = "Regioner") +
  theme_minimal()
```

**Tekst om hvorfor vi har valgt Norge, Svergie og Danmark osv....**

```{r}
library(ggplot2)

maindata %>%
  filter(geo %in% c("DK", "NO", "SE")) %>%
  group_by(geo, classification_nr, TIME_PERIOD) %>%
  summarise(mean_value = mean(OBS_VALUE, na.rm = TRUE)) %>%
  mutate(demeaned_value = mean_value / first(mean_value)) %>%
  ggplot(aes(x = TIME_PERIOD, y = demeaned_value, color = classification_nr)) +
  geom_line() +
  geom_point() +
  labs(x = "칀r",
       y = "Gjennomsnittlig Befolkningsvekst",
       color = "Regioner") +
  theme_minimal() +
  facet_wrap(~geo, scales = "free_y")

```

Hva forteller diagrammene oss....

**Tekst om hvorfor vi har valgt Spania, Italia og Frankriket**

```{r}
library(ggplot2)

maindata %>%
  filter(geo %in% c("ES", "IT", "FR")) %>%
  group_by(geo, classification_nr, TIME_PERIOD) %>%
  summarise(mean_value = mean(OBS_VALUE, na.rm = TRUE)) %>%
  mutate(demeaned_value = mean_value / first(mean_value)) %>%
  ggplot(aes(x = TIME_PERIOD, y = demeaned_value, color = classification_nr)) +
  geom_line() +
  geom_point() +
  labs(x = "칀r",
       y = "Gjennomsnittlig Befolkningsvekst",
       color = "Regioner") +
  theme_minimal() +
  facet_wrap(~geo, scales = "free_y")

```

Hva forteller diagrammene oss....游뱂

F

### Oppgave 4 - Tolking og forhold til kurslitteratur
