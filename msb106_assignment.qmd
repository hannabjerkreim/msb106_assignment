---
title: "msb106_assignment"
format: html
editor: visual
---

# Evolving Landscapes: Analysere dynamikken i by- og bygdeutvikling i Europa

**MSB106 Anvendt by- og regionaløkonomi\
Assignment Spring 2024**

**Hanna Sundal Bjerkreim, Ingrid Strømme og Emilie Hansen Sørhaug**

Målet med denne oppgaven er å gi en forståelse av noen av de potensielle driverne som bidrar til skillet mellom by og land i Europa.
Vi vil fordype oss i påvirkningen av faktorer som former denne inndelingen, som lokale arbeidsmarkedsforhold, påvirker mønstre for befolkningsfordeling og jobbskaping på tvers av ulike europeiske landskap.

```{r}
#| label: setup 
#| output: false
#| message: false
library(tidyverse)
library(readxl)
library(dplyr)
library(ggplot2)
```

## Del 1: Datainnsamling og innledende analyse

Den første delen presenterer en oversikt over datainnsamlingsprosessen, etterfulgt av en analyse av befolkningsvekstdynamikken i ulike europeiske regioner.

### Oppgave 1 -- Datainnsamling

```{r}
data <- read_csv("ilc_lvho01__custom_9371289_linear.csv", 
    locale = locale(date_names = "nb", encoding = "ISO-8859-1"))
```

```{r}
columns_to_remove <- c("DATAFLOW", "LAST UPDATE", "freq", "incgrp", "building", "unit", "OBS_FLAG")
data <- data[, !(names(data) %in% columns_to_remove)]
```

```{r}
data <- data %>% 
  filter(geo != "LV") |> 
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural areas"
  ))
```

### Oppgave 2 - Data analyse

**tesk....**

```{r}
data %>%
  group_by(deg_urb, TIME_PERIOD) %>%
  summarise(mean_value = mean(OBS_VALUE)) %>%
  ggplot(aes(x = TIME_PERIOD, y = mean_value, color = deg_urb)) +
  geom_line() +
  labs(title = "Gjennomsnittlig Befolkningsvekst etter Område",
       x = "År",
       y = "Gjennomsnittlig Befolkningsvekst",
       color = "Område") +
  theme_minimal()

```

**Cities**

```{r}
deg1_data <- data |> 
  filter(deg_urb == "Cities")

summary(deg1_data$OBS_VALUE)
```

```{r}
standardavvik_deg1 <- sd(deg1_data$OBS_VALUE)

# Vis resultatet
print(standardavvik_deg1)

```

Gjennomnsittlig befolkningsvekst i "Cities" er 40,01 for perioden 2003-2022.
Modellen over viser hvordan gjennomsnittet har utviklet seg for disse årene.
Det er stor variasjon gjennom årene med et standardavvik på 13.91.

**"Towns and Suburbs"**

```{r}
deg2_data <- data |> 
  filter(deg_urb == "Towns/Suburbs")

summary(deg2_data$OBS_VALUE)
```

```{r}
standardavvik_deg2 <- sd(deg2_data$OBS_VALUE)

# Vis resultatet
print(standardavvik_deg2)
```

Gjennonsnittlig befolkningsvekst for "Towns and Suburbs" er på 27,23.
Det er stor variasjon også i denne område typen hvor den laveste verdien er 0.00 og høyeste er 55.30.
Standardavviket viser også til at det har vært en stor variasjon, med en verdi på 12.43.

**Rural areas**

```{r}
deg3_data <- data |> 
  filter(deg_urb == "Rural areas")

summary(deg3_data$OBS_VALUE)
```

```{r}
standardavvik_deg3 <- sd(deg3_data$OBS_VALUE)

# Vis resultatet
print(standardavvik_deg3)
```

Gjennomsnittet i "Rural areas" er på 32,76 i perioden 2003-2022, hvor spredningen går fra 0.00 til 66.60.
Her ser vi altså en større spredning enn Towns og Suburbs som også foklarer et høyere standardavvik på 14,52

```{r}
cities_plot <- data |> 
  filter(deg_urb == "Cities") |> 
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE, color = geo)) +
  geom_line() +
  labs(title = "Population Growth Trends in Cities by Country",
       x = "Year",
       y = "Population Growth",
       color = "Country")

print(cities_plot)
```

```{r}
towns_suburbs_plot <- data |> 
  filter(deg_urb == "Towns/Suburbs") |> 
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE, color = geo)) +
  geom_line() +
  labs(title = "Population Growth Trends in Towns and Suburbs by Country",
       x = "Year",
       y = "Population Growth",
       color = "Country")

print(towns_suburbs_plot)
```

```{r}
rural_plot <- data |> 
  filter(deg_urb == "Rural areas") |> 
  ggplot(aes(x = TIME_PERIOD, y = OBS_VALUE, color = geo)) +
  geom_line() +
  labs(title = "Population Growth Trends in Rural areas by Country",
       x = "Year",
       y = "Population Growth",
       color = "Country")

print(rural_plot)
```

## Del 2: Avansert analyse - Forstå virkningen av økonomiske faktorer på befolkningsvekst

I den andre delen vil vi utvide dataene som er samlet inn i den første delen ved å inkludere flere økonomiske faktorer.
Vår analyse vil fokusere på hvordan disse faktorene korrelerer med befolkningsvekst i ulike regioner, ved å bruke klassifiseringsmetodikken beskrevet i kapittel 5 av Andersson, Håkansson og Thorsen (2023).

### Oppgave 1 -- Innsamling av tilleggsdata

```{r}
data1 <- arbeidskraft <- read_csv("arbeidskraft.csv") |> 
  select(arbeidsvekst = OBS_VALUE, geo, age, deg_urb, TIME_PERIOD)

data2 <- arbeidsledighet1 <- read_csv("arbeidsledighet1.csv") |> 
  select(arbeidsledig = OBS_VALUE, geo,age, deg_urb, TIME_PERIOD)

data3 <- huspris <- read_csv("huspris.csv") |> 
  select(huspris = OBS_VALUE, geo, deg_urb, TIME_PERIOD)
```

```{r}
arbeidsvekst <- data1 |>
  filter(age == "Y15-64") |>
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural Areas",
    TRUE ~ as.character(deg_urb)  # Beholder andre verdier uendret
  ))
```

```{r}
arbeidsledige <- data2 |> 
  filter(age == "Y15-64") |>
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural Areas",
    TRUE ~ as.character(deg_urb)  # Beholder andre verdier uendret
  ))
```

```{r}
huspris <- data3 |> 
  mutate(deg_urb = case_when(
    deg_urb == "DEG1" ~ "Cities",
    deg_urb == "DEG2" ~ "Towns/Suburbs",
    deg_urb == "DEG3" ~ "Rural Areas",
    TRUE ~ as.character(deg_urb)  # Beholder andre verdier uendret
  ))
```

```{r}
join <- arbeidsvekst |> 
  left_join(arbeidsledige, join_by(geo, TIME_PERIOD, deg_urb))

join1 <- join |> 
  left_join(huspris, join_by(geo, TIME_PERIOD, deg_urb))

maindata <- join1 |> 
  left_join(data, join_by(geo, TIME_PERIOD, deg_urb))
```

### Oppgave 2 - Anvendelse av klassifiseringsmetodikk

```{r}
maindata <- maindata %>%
  group_by(geo, TIME_PERIOD) %>%
  mutate(arb.ledig.geo.mean = mean(arbeidsledig, na.rm = TRUE), huspris.geo.mean = mean(huspris, na.rm = TRUE), arb.vekst.geo.mena = mean(arbeidsvekst, na.rm = TRUE))

```

```{r}
maindata <- maindata %>%
  mutate(classification = case_when(
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "1.høy arbeisledighet, høy arbeidsvekst, høy huspris",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "2.høy arbeisledighet, høy arbeidsvekst, lav huspris",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "3.høy arbeisledighet, lav arbeidsvekst, høy huspris",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "4.høy arbeisledighet, lav arbeidsvekst, lav huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "5.lav arbeisledighet, høy arbeidsvekst, høy huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "6.lav arbeisledighet, høy arbeidsvekst, lav huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "7.lav arbeisledighet, lav arbeidsvekst, høy huspris",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "8. lav arbeisledighet, lav arbeidsvekst, lav huspris",
    TRUE ~ "unknown")
  )
```

```{r}
maindata <- maindata %>%
  mutate(classification_nr = case_when(
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "1",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "2",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "3",
    arbeidsledig > arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "4",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "5",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst > arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "6",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris > huspris.geo.mean ~ "7",
    arbeidsledig <= arb.ledig.geo.mean & arbeidsvekst <= arb.vekst.geo.mena & huspris <= huspris.geo.mean ~ "8",
    TRUE ~ "unknown")
  )
```

### Oppgave 3 - Analyse og visualisering

```{r}
# Lag stolpediagram
stolpediagram <- ggplot(maindata, aes(x = as.factor(classification_nr), fill = deg_urb)) +
  geom_bar(position = "dodge", stat = "count") +
  labs(title = "Stolpediagram basert på Classification_nr og deg_urb",
       x = "classification_nr",
       y = "Antall") +
  theme_minimal()

# Vis stolpediagrammet
print(stolpediagram)
```

Utvikling:

```{r}
maindata %>%
  group_by(classification_nr, TIME_PERIOD) %>%
  mutate(realtive_growth = OBS_VALUE / first(OBS_VALUE) * 100) %>%
  ungroup()

  ggplot(aes(x = TIME_PERIOD, y = mean_value, color = as.character(classification_nr))) +
  geom_line() +
  labs(title = "Gjennomsnittlig Observed Value etter Classification Number",
       x = "Time Period",
       y = "Gjennomsnittlig Observed Value",
       color = "Classification Number") +
  theme_minimal()
```

```         
```

```         
```

### Oppgave 4 - Tolking og forhold til kurslitteratur
